/**
 * tracking.js - Augmented Reality JavaScript Framework.
 * @author Eduardo Lundgren <edu@rdo.io>
 * @version v1.0.0-alpha
 * @link http://trackingjs.com
 * @license BSD
 */
!function(r){r.tracking=r.tracking||{},tracking.forEach=function(r,t,a){var n;if(Array.isArray(r))r.forEach(function(){t.apply(a,arguments)});else for(n in r)r.hasOwnProperty(n)&&t.call(a,r[n],n,r);return r},tracking.inherits=function(r,t){function a(){}a.prototype=t.prototype,r.superClass_=t.prototype,r.prototype=new a,r.prototype.constructor=r,r.base=function(r,a){var n=Array.prototype.slice.call(arguments,2);return t.prototype[a].apply(r,n)}},tracking.initUserMedia_=function(t,a){r.navigator.getUserMedia({video:!0,audio:a.audio},function(a){try{t.src=r.URL.createObjectURL(a)}catch(n){t.src=a}},function(){throw Error("Cannot capture user camera.")})},tracking.isNode=function(r){return r.nodeType||this.isWindow(r)},tracking.isWindow=function(r){return!!(r&&r.alert&&r.document)},tracking.merge=function(r,t){for(var a in t)r[a]=t[a];return r},tracking.one=function(r,t){return this.isNode(r)?r:(t||document).querySelector(r)},tracking.track=function(r,t,a){if(r=tracking.one(r),!r)throw new Error("Element not found, try a different element or selector.");if(!t)throw new Error("Tracker not specified, try `tracking.track(element, new tracking.FaceTracker())`.");switch(r.nodeName.toLowerCase()){case"canvas":return this.trackCanvas_(r,t,a);case"img":return this.trackImg_(r,t,a);case"video":return a&&a.camera&&this.initUserMedia_(r,a),this.trackVideo_(r,t,a);default:throw new Error("Element not supported, try in a canvas, img, or video.")}},tracking.trackCanvas_=function(r,t){var a=r.width,n=r.height,i=r.getContext("2d"),e=i.getImageData(0,0,a,n);t.track(e.data,a,n)},tracking.trackImg_=function(r,t){var a=r.width,n=r.height,i=document.createElement("canvas");i.width=a,i.height=n,tracking.Canvas.loadImage(i,r.src,0,0,a,n,function(){tracking.trackCanvas_(i,t)})},tracking.trackVideo_=function(t,a){var n=document.createElement("canvas"),i=n.getContext("2d"),e=t.offsetWidth,o=t.offsetHeight;n.width=e,n.height=o,r.requestAnimationFrame(function(){t.readyState===t.HAVE_ENOUGH_DATA&&(i.drawImage(t,0,0,e,o),tracking.trackCanvas_(n,a)),tracking.trackVideo_(t,a)})},r.URL||(r.URL=r.URL||r.webkitURL||r.msURL||r.oURL),navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}(window),function(){tracking.Brief={},tracking.Brief.N=128,tracking.Brief.randomOffsets_={},tracking.Brief.getDescriptors=function(r,t,a){for(var n=new Int32Array(a.length*(this.N>>5)),i=0,e=this.getRandomOffsets_(t),o=0,c=0;c<a.length;c+=2)for(var s=t*a[c+1]+a[c],g=0,k=this.N;k>g;g++)r[e[g+g]+s]<r[e[g+g+1]+s]&&(i|=1<<(31&g)),g+1&31||(n[o++]=i,i=0);return n},tracking.Brief.match=function(r,t,a,n){for(var i=r.length>>1,e=a.length>>1,o=new Int32Array(i),c=0;i>c;c++){for(var s=1/0,g=0,k=0;e>k;k++){for(var u=0,f=0,h=this.N>>5;h>f;f++)u+=tracking.Math.hammingWeight(t[c*h+f]^n[k*h+f]);s>u&&(s=u,g=k)}o[c]=g}return o},tracking.Brief.getRandomOffsets_=function(r){if(this.randomOffsets_[r])return this.randomOffsets_[r];for(var t=new Int32Array(2*this.N),a=0,n=0;n<this.N;n++)t[a++]=tracking.Math.uniformRandom(-15,16)*r+tracking.Math.uniformRandom(-15,16),t[a++]=tracking.Math.uniformRandom(-15,16)*r+tracking.Math.uniformRandom(-15,16);return this.randomOffsets_[r]=t,this.randomOffsets_[r]}}(),function(){tracking.Canvas={},tracking.Canvas.loadImage=function(r,t,a,n,i,e,o){var c=this,s=new window.Image;s.onload=function(){var t=r.getContext("2d");r.width=i,r.height=e,t.drawImage(s,a,n,i,e),o&&o.call(c),s=null},s.src=t}}(),function(){tracking.EPnP={},tracking.EPnP.solve=function(){}}(),function(){tracking.ViolaJones={},tracking.ViolaJones.BOUNDING_REGIONS_OVERLAP=.5,tracking.ViolaJones.BLOCK_SIZE=20,tracking.ViolaJones.BLOCK_JUMP=2,tracking.ViolaJones.BLOCK_SCALE=1.25,tracking.ViolaJones.detect=function(r,t,a,n){for(var i=tracking.Matrix.computeIntergralImage(r,t,a),e=i[0],o=i[1],c=this.BLOCK_SIZE,s=1/this.BLOCK_SIZE,g=Math.min(t,a),k=0,u=[];g>=c;c=~~(c*this.BLOCK_SCALE))for(var f=c*s,h=1/(c*c),l=0,d=0,v=a-c,m=t-c,C=0;v>C;C+=this.BLOCK_JUMP){l=~~C;for(var p=0;m>p;p+=this.BLOCK_JUMP)d=~~p,this.evalStages_(n,e,o,l,d,t,c,f,h)&&(u[k++]={size:c,x:d,y:l})}return tracking.ViolaJones.mergeRectangles(u)},tracking.ViolaJones.evalStages_=function(r,t,a,n,i,e,o,c,s){var g=n*e+i,k=n*e+(i+o),u=(n+o)*e+i,f=(n+o)*e+(i+o),h=t[g]-t[k]-t[u]+t[f],l=a[g]-a[k]-a[u]+a[f],d=h*s,v=l*s-d*d;v=v>1?Math.sqrt(v):1;for(var m=r.length,C=0;m>C;){for(var p=0,T=r[C++],y=r[C++];y--;){for(var _=0,A=r[C++],w=0;A>w;w++){var M=i+~~(r[C++]*c),R=n+~~(r[C++]*c),E=~~(r[C++]*c),I=~~(r[C++]*c),O=r[C++],F=M+E,L=R+I,N=R*e+M,U=R*e+F,B=L*e+M,D=L*e+F;_+=(t[N]-t[U]-t[B]+t[D])*O}var H=r[C++],S=r[C++],x=r[C++];p+=H*v>_*s?S:x}if(T>=p)return!1}return!0},tracking.ViolaJones.mergeRectangles=function(r){for(var t,a=r.length,n=new Uint32Array(a),i={},e=0;a>e;e++)if(!n[e]){var o=r[e];n[e]=!0,i[e]={count:1,rect:o};for(var c=o.x,s=o.y,g=o.size,k=c+g,u=s+g,f=e+1;a>f;f++)if(!n[f]){var h=r[f];if(e!==f){var l=h.x,d=h.y,v=h.size,m=l+v,C=d+v;if(tracking.Math.intersectRect(c,s,k,u,l,d,m,C)){var p=Math.max(c,l),T=Math.max(s,d),y=Math.min(k,m),_=Math.min(u,C),A=(p-y)*(T-_);A/(g*g)>=this.BOUNDING_REGIONS_OVERLAP&&A/(v*v)>=this.BOUNDING_REGIONS_OVERLAP&&(t=i[e],n[f]=!0,t.count++,g>v&&(t.rect=h))}}}}var w=[];for(e in i)t=i[e],t.count>1&&w.push(t.rect);return w}}(),function(){tracking.Fast={},tracking.Fast.FAST_THRESHOLD=40,tracking.Fast.circles_={},tracking.Fast.findCorners=function(r,t,a){for(var n=this.getCircleOffsets_(t),i=new Int32Array(16),e=[],o=3;a-3>o;o++)for(var c=3;t-3>c;c++){for(var s=o*t+c,g=r[s],k=0;16>k;k++)i[k]=r[s+n[k]];this.isCorner(g,i,this.FAST_THRESHOLD)&&(e.push(c,o),c+=3)}return e},tracking.Fast.isBrighter=function(r,t,a){return r-t>a},tracking.Fast.isCorner=function(r,t,a){var n,i,e;if(this.isTriviallyExcluded(t,r,a))return!1;for(var o=0;16>o;o++){e=!0,n=!0;for(var c=0;9>c&&(i=t[o+c&15],this.isBrighter(r,i,a)||(n=!1,e!==!1))&&(this.isDarker(r,i,a)||(e=!1,n!==!1));c++);if(n||e)return!0}return!1},tracking.Fast.isDarker=function(r,t,a){return t-r>a},tracking.Fast.isTriviallyExcluded=function(r,t,a){var n=0,i=r[8],e=r[12],o=r[4],c=r[0];return this.isBrighter(c,t,a)&&n++,this.isBrighter(o,t,a)&&n++,this.isBrighter(i,t,a)&&n++,this.isBrighter(e,t,a)&&n++,3>n&&(n=0,this.isDarker(c,t,a)&&n++,this.isDarker(o,t,a)&&n++,this.isDarker(i,t,a)&&n++,this.isDarker(e,t,a)&&n++,3>n)?!0:!1},tracking.Fast.getCircleOffsets_=function(r){if(this.circles_[r])return this.circles_[r];var t=new Int32Array(16);return t[0]=-r-r-r,t[1]=t[0]+1,t[2]=t[1]+r+1,t[3]=t[2]+r+1,t[4]=t[3]+r,t[5]=t[4]+r,t[6]=t[5]+r-1,t[7]=t[6]+r-1,t[8]=t[7]-1,t[9]=t[8]-1,t[10]=t[9]-r-1,t[11]=t[10]-r-1,t[12]=t[11]-r,t[13]=t[12]-r,t[14]=t[13]-r+1,t[15]=t[14]-r+1,this.circles_[r]=t,t}}(),function(){tracking.Image={},tracking.Image.calculateLumaGrayscale=function(r,t,a){for(var n=new Uint8ClampedArray(t*a),i=0,e=0,o=0;a>o;o++)for(var c=0;t>c;c++)n[i++]=.299*r[e]+.587*r[e+1]+.114*r[e+2],e+=4;return n}}(),function(){tracking.Math={},tracking.Math.distance=function(r,t,a,n){var i=a-r,e=n-t;return Math.sqrt(i*i+e*e)},tracking.Math.hammingWeight=function(r){return r-=r>>1&1431655765,r=(858993459&r)+(r>>2&858993459),16843009*(r+(r>>4)&252645135)>>24},tracking.Math.uniformRandom=function(r,t){return r+Math.random()*(t-r)},tracking.Math.intersectRect=function(r,t,a,n,i,e,o,c){return!(i>a||r>o||e>n||t>c)}}(),function(){tracking.Matrix={},tracking.Matrix.forEach=function(r,t,a,n,i){var e,o=i||1,c=0,s=0;for(c=0;a>c;c+=o)for(s=0;t>s;s+=o)e=c*t*4+4*s,n.call(this,r[e],r[e+1],r[e+2],r[e+3],e,c,s)},tracking.Matrix.computeIntergralImage=function(r,t,a){for(var n=new Int32Array(t*a),i=new Int32Array(t*a),e=0,o=0,c=0,s=0;a>s;s++)for(var g=0;t>g;g++){var k=s*t*4+4*g,u=~~(.299*r[k]+.587*r[k+1]+.114*r[k+2]);0===s&&0===g?(o=u,c=u*u):0===s?(o=u+n[s*t+(g-1)],c=u*u+i[s*t+(g-1)]):0===g?(o=u+n[(s-1)*t+g],c=u*u+i[(s-1)*t+g]):(o=u+n[s*t+(g-1)]+n[(s-1)*t+g]-n[(s-1)*t+(g-1)],c=u*u+i[s*t+(g-1)]+i[(s-1)*t+g]-i[(s-1)*t+(g-1)]),n[e]=o,i[e]=c,e++}return[n,i]}}(),function(){tracking.Tracker=function(){},tracking.Tracker.prototype.onFound=function(){},tracking.Tracker.prototype.onNotFound=function(){},tracking.Tracker.prototype.track=function(){}}(),function(){tracking.HAARTracker=function(){tracking.HAARTracker.base(this,"constructor")},tracking.inherits(tracking.HAARTracker,tracking.Tracker),tracking.HAARTracker.data={},tracking.Tracker.prototype.data=null,tracking.Tracker.prototype.getData=function(){return this.data},tracking.HAARTracker.prototype.track=function(r,t,a){var n=this.getData();if(!n)throw new Error("HAAR cascade data not set.");var i=tracking.ViolaJones.detect(r,t,a,n);i.length?this.onFound&&this.onFound.call(this,i):this.onNotFound&&this.onNotFound.call(this,i)},tracking.Tracker.prototype.setData=function(r){this.data=r}}(),function(){tracking.ColorTracker=function(){tracking.ColorTracker.base(this,"constructor"),this.setColors(["magenta"])},tracking.inherits(tracking.ColorTracker,tracking.Tracker),tracking.ColorTracker.MIN_PIXELS=30,tracking.ColorTracker.knownColors_={},tracking.ColorTracker.registerColor=function(r,t){tracking.ColorTracker.knownColors_[r]=t},tracking.ColorTracker.getColor=function(r){return tracking.ColorTracker.knownColors_[r]},tracking.ColorTracker.prototype.colors=null,tracking.ColorTracker.prototype.calculateCentralCoordinate_=function(r,t){for(var a=0,n=0,i=-1,e=-1,o=1/0,c=1/0,s=0,g=0;t>g;g+=2){var k=r[g],u=r[g+1];k>-1&&u>-1&&(a+=k,n+=u,s++,o>k&&(o=k),k>i&&(i=k),c>u&&(c=u),u>e&&(e=u))}return 0===s?null:{x:a/s,y:n/s,z:60-(i-o+(e-c))/2}},tracking.ColorTracker.prototype.flagOutliers_=function(r,t){for(var a=0;t>a;a+=2){for(var n=0,i=2;t>i;i+=2)n+=tracking.Math.distance(r[a],r[a+1],r[i],r[i+1]);n/t>=tracking.ColorTracker.MIN_PIXELS&&(r[a]=-1,r[a+1]=-1,t[a]--)}},tracking.ColorTracker.prototype.getColors=function(){return this.colors},tracking.ColorTracker.prototype.setColors=function(r){this.colors=r},tracking.ColorTracker.prototype.track=function(r,t,a){var n,i,e,o=this,c=this.getColors(),s=[],g=[],k=[];for(tracking.Matrix.forEach(r,t,a,function(r,t,a,g,u,f,h){for(e=-1;n=c[++e];)s[e]||(k[e]=0,s[e]=[]),i=tracking.ColorTracker.knownColors_[n],i&&i.call(o,r,t,a,g,u,f,h)&&(k[e]+=2,s[e].push(h,f))}),e=-1;n=c[++e];)if(!(k[e]<tracking.ColorTracker.MIN_PIXELS)){o.flagOutliers_(s[e],k[e]);var u=o.calculateCentralCoordinate_(s[e],k[e]);u&&(u.color=c[e],u.pixels=s[e],g.push(u))}g.length?o.onFound&&o.onFound.call(o,g):o.onNotFound&&o.onNotFound.call(o,g)},tracking.ColorTracker.registerColor("cyan",function(r,t,a){var n=50,i=70,e=r-0,o=t-255,c=a-255;return t-r>=n&&a-r>=i?!0:Math.sqrt(e*e+o*o+c*c)<80}),tracking.ColorTracker.registerColor("magenta",function(r,t,a){var n=50,i=r-255,e=t-0,o=a-255;return r-t>=n&&a-t>=n?!0:Math.sqrt(i*i+e*e+o*o)<140}),tracking.ColorTracker.registerColor("yellow",function(r,t,a){var n=50,i=r-255,e=t-255,o=a-0;return r-t>=n&&a-t>=n?!0:Math.sqrt(i*i+e*e+o*o)<100})}(),function(){tracking.EyeTracker=function(){tracking.EyeTracker.base(this,"constructor"),this.setData(new Float64Array(tracking.HAARTracker.data.eye))},tracking.inherits(tracking.EyeTracker,tracking.HAARTracker)}(),function(){tracking.FaceTracker=function(){tracking.FaceTracker.base(this,"constructor"),this.setData(new Float64Array(tracking.HAARTracker.data.face))},tracking.inherits(tracking.FaceTracker,tracking.HAARTracker)}(),function(){tracking.MouthTracker=function(){tracking.MouthTracker.base(this,"constructor"),this.setData(new Float64Array(tracking.HAARTracker.data.mouth))},tracking.inherits(tracking.MouthTracker,tracking.HAARTracker)}();