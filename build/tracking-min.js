/**
 * tracking.js - Augmented Reality JavaScript Framework.
 * @author Eduardo Lundgren <edu@rdo.io>
 * @version v1.0.0-alpha
 * @link http://trackingjs.com
 * @license BSD
 */
!function(t){t.tracking=t.tracking||{},tracking.forEach=function(t,r,n){var a;if(Array.isArray(t))t.forEach(function(){r.apply(n,arguments)});else for(a in t)t.hasOwnProperty(a)&&r.call(n,t[a],a,t);return t},tracking.inherits=function(t,r){function n(){}n.prototype=r.prototype,t.superClass_=r.prototype,t.prototype=new n,t.prototype.constructor=t,t.base=function(t,n){var a=Array.prototype.slice.call(arguments,2);return r.prototype[n].apply(t,a)}},tracking.initUserMedia_=function(r,n){t.navigator.getUserMedia({video:!0,audio:n.audio},function(n){try{r.src=t.URL.createObjectURL(n)}catch(a){r.src=n}},function(){throw Error("Cannot capture user camera.")})},tracking.isNode=function(t){return t.nodeType||this.isWindow(t)},tracking.isWindow=function(t){return!!(t&&t.alert&&t.document)},tracking.merge=function(t,r){for(var n in r)t[n]=r[n];return t},tracking.one=function(t,r){return this.isNode(t)?t:(r||document).querySelector(t)},tracking.track=function(t,r,n){if(t=tracking.one(t),!t)throw new Error("Element not found, try a different element or selector.");if(!r)throw new Error("Tracker not specified, try `tracking.track(element, new tracking.FaceTracker())`.");switch(t.nodeName.toLowerCase()){case"canvas":return this.trackCanvas_(t,r,n);case"img":return this.trackImg_(t,r,n);case"video":return n&&n.camera&&this.initUserMedia_(t,n),this.trackVideo_(t,r,n);default:throw new Error("Element not supported, try in a canvas, img, or video.")}},tracking.trackCanvas_=function(t,r){var n=t.width,a=t.height,i=t.getContext("2d"),e=i.getImageData(0,0,n,a);r.track(e.data,n,a)},tracking.trackImg_=function(t,r){var n=t.width,a=t.height,i=document.createElement("canvas");i.width=n,i.height=a,tracking.Canvas.loadImage(i,t.src,0,0,n,a,function(){tracking.trackCanvas_(i,r)})},tracking.trackVideo_=function(r,n){var a,i,e=document.createElement("canvas"),o=e.getContext("2d"),c=function(){a=r.offsetWidth,i=r.offsetHeight,e.width=a,e.height=i};c(),r.addEventListener("resize",c);var s=function(){t.requestAnimationFrame(function(){if(r.readyState===r.HAVE_ENOUGH_DATA){try{o.drawImage(r,0,0,a,i)}catch(t){}tracking.trackCanvas_(e,n)}s()})};s()},t.URL||(t.URL=t.URL||t.webkitURL||t.msURL||t.oURL),navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)}(window),function(){tracking.Brief={},tracking.Brief.N=128,tracking.Brief.randomOffsets_={},tracking.Brief.getDescriptors=function(t,r,n){for(var a=new Int32Array(n.length*(this.N>>5)),i=0,e=this.getRandomOffsets_(r),o=0,c=0;c<n.length;c+=2)for(var s=r*n[c+1]+n[c],g=0,h=this.N;h>g;g++)t[e[g+g]+s]<t[e[g+g+1]+s]&&(i|=1<<(31&g)),g+1&31||(a[o++]=i,i=0);return a},tracking.Brief.match=function(t,r,n,a){for(var i=t.length>>1,e=n.length>>1,o=new Int32Array(i),c=0;i>c;c++){for(var s=1/0,g=0,h=0;e>h;h++){for(var k=0,u=0,l=this.N>>5;l>u;u++)k+=tracking.Math.hammingWeight(r[c*l+u]^a[h*l+u]);s>k&&(s=k,g=h)}o[c]=g}return o},tracking.Brief.getRandomOffsets_=function(t){if(this.randomOffsets_[t])return this.randomOffsets_[t];for(var r=new Int32Array(2*this.N),n=0,a=0;a<this.N;a++)r[n++]=tracking.Math.uniformRandom(-15,16)*t+tracking.Math.uniformRandom(-15,16),r[n++]=tracking.Math.uniformRandom(-15,16)*t+tracking.Math.uniformRandom(-15,16);return this.randomOffsets_[t]=r,this.randomOffsets_[t]}}(),function(){tracking.Canvas={},tracking.Canvas.loadImage=function(t,r,n,a,i,e,o){var c=this,s=new window.Image;s.onload=function(){var r=t.getContext("2d");t.width=i,t.height=e,r.drawImage(s,n,a,i,e),o&&o.call(c),s=null},s.src=r}}(),function(){tracking.EPnP={},tracking.EPnP.solve=function(){}}(),function(){tracking.ViolaJones={},tracking.ViolaJones.REGIONS_OVERLAP=.5,tracking.ViolaJones.detect=function(t,r,n,a,i,e,o,c){var s,g=0,h=[],k=new Int32Array(r*n),u=new Int32Array(r*n),l=new Int32Array(r*n);o>0&&(s=new Int32Array(r*n)),tracking.Image.computeIntegralImage(t,r,n,k,u,l,s);for(var f=c[0],m=c[1],y=a*i,v=y*f|0,d=y*m|0;r>v&&n>d;){for(var p=y*e+.5|0,A=0;n-d>A;A+=p)for(var T=0;r-v>T;T+=p)o>0&&this.isTriviallyExcluded(o,s,A,T,r,v,d)||this.evalStages_(c,k,u,l,A,T,r,v,d,y)&&(h[g++]={width:v,height:d,x:T,y:A});y*=i,v=y*f|0,d=y*m|0}return this.mergeRectangles_(h)},tracking.ViolaJones.isTriviallyExcluded=function(t,r,n,a,i,e,o){var c=n*i+a,s=c+e,g=c+o*i,h=g+e,k=(r[c]-r[s]-r[g]+r[h])/(e*o*255);return t>k?!0:!1},tracking.ViolaJones.evalStages_=function(t,r,n,a,i,e,o,c,s,g){var h=1/(c*s),k=i*o+e,u=k+c,l=k+s*o,f=l+c,m=(r[k]-r[u]-r[l]+r[f])*h,y=(n[k]-n[u]-n[l]+n[f])*h-m*m,v=1;y>0&&(v=Math.sqrt(y));for(var d=t.length,p=2;d>p;){for(var A=0,T=t[p++],w=t[p++];w--;){for(var x=0,C=t[p++],_=t[p++],R=0;_>R;R++){var I,M,S,F,E=e+t[p++]*g+.5|0,H=i+t[p++]*g+.5|0,D=t[p++]*g+.5|0,b=t[p++]*g+.5|0,N=t[p++];C?(I=E-b+D+(H+D+b-1)*o,M=E+(H-1)*o,S=E-b+(H+b-1)*o,F=E+D+(H+D-1)*o,x+=(a[I]+a[M]-a[S]-a[F])*N):(I=H*o+E,M=I+D,S=I+b*o,F=S+D,x+=(r[I]-r[M]-r[S]+r[F])*N)}var O=t[p++],U=t[p++],V=t[p++];A+=O*v>x*h?U:V}if(T>A)return!1}return!0},tracking.ViolaJones.mergeRectangles_=function(t){for(var r=new tracking.DisjointSet(t.length),n=0;n<t.length;n++)for(var a=t[n],i=0;i<t.length;i++){var e=t[i];if(tracking.Math.intersectRect(a.x,a.y,a.x+a.width,a.y+a.height,e.x,e.y,e.x+e.width,e.y+e.height)){var o=Math.max(a.x,e.x),c=Math.max(a.y,e.y),s=Math.min(a.x+a.width,e.x+e.width),g=Math.min(a.y+a.height,e.y+e.height),h=(o-s)*(c-g),k=a.width*a.height,u=e.width*e.height;h/(k*(k/u))>=this.REGIONS_OVERLAP&&h/(u*(k/u))>=this.REGIONS_OVERLAP&&r.union(n,i)}}for(var l={},f=0;f<r.length;f++){var m=r.find(f);l[m]?(l[m].total++,l[m].width+=t[f].width,l[m].height+=t[f].height,l[m].x+=t[f].x,l[m].y+=t[f].y):l[m]={total:1,width:t[f].width,height:t[f].height,x:t[f].x,y:t[f].y}}var y=[];return Object.keys(l).forEach(function(t){var r=l[t];y.push({total:r.total,width:r.width/r.total+.5|0,height:r.height/r.total+.5|0,x:r.x/r.total+.5|0,y:r.y/r.total+.5|0})}),y}}(),function(){tracking.Fast={},tracking.Fast.FAST_THRESHOLD=40,tracking.Fast.circles_={},tracking.Fast.findCorners=function(t,r,n){for(var a=this.getCircleOffsets_(r),i=new Int32Array(16),e=[],o=3;n-3>o;o++)for(var c=3;r-3>c;c++){for(var s=o*r+c,g=t[s],h=0;16>h;h++)i[h]=t[s+a[h]];this.isCorner(g,i,this.FAST_THRESHOLD)&&(e.push(c,o),c+=3)}return e},tracking.Fast.isBrighter=function(t,r,n){return t-r>n},tracking.Fast.isCorner=function(t,r,n){var a,i,e;if(this.isTriviallyExcluded(r,t,n))return!1;for(var o=0;16>o;o++){e=!0,a=!0;for(var c=0;9>c&&(i=r[o+c&15],this.isBrighter(t,i,n)||(a=!1,e!==!1))&&(this.isDarker(t,i,n)||(e=!1,a!==!1));c++);if(a||e)return!0}return!1},tracking.Fast.isDarker=function(t,r,n){return r-t>n},tracking.Fast.isTriviallyExcluded=function(t,r,n){var a=0,i=t[8],e=t[12],o=t[4],c=t[0];return this.isBrighter(c,r,n)&&a++,this.isBrighter(o,r,n)&&a++,this.isBrighter(i,r,n)&&a++,this.isBrighter(e,r,n)&&a++,3>a&&(a=0,this.isDarker(c,r,n)&&a++,this.isDarker(o,r,n)&&a++,this.isDarker(i,r,n)&&a++,this.isDarker(e,r,n)&&a++,3>a)?!0:!1},tracking.Fast.getCircleOffsets_=function(t){if(this.circles_[t])return this.circles_[t];var r=new Int32Array(16);return r[0]=-t-t-t,r[1]=r[0]+1,r[2]=r[1]+t+1,r[3]=r[2]+t+1,r[4]=r[3]+t,r[5]=r[4]+t,r[6]=r[5]+t-1,r[7]=r[6]+t-1,r[8]=r[7]-1,r[9]=r[8]-1,r[10]=r[9]-t-1,r[11]=r[10]-t-1,r[12]=r[11]-t,r[13]=r[12]-t,r[14]=r[13]-t+1,r[15]=r[14]-t+1,this.circles_[t]=r,r}}(),function(){tracking.Image={},tracking.Image.computeIntegralImage=function(t,r,n,a,i,e,o){if(arguments.length<4)throw new Error("You should specify at least one output array in the order: sum, square, tilted, sobel.");var c;o&&(c=tracking.Image.sobel(t,r,n));for(var s=0;n>s;s++)for(var g=0;r>g;g++){var h=s*r*4+4*g,k=~~(.299*t[h]+.587*t[h+1]+.114*t[h+2]);if(a&&this.computePixelValueSAT_(a,r,s,g,k),i&&this.computePixelValueSAT_(i,r,s,g,k*k),e){var u=h-4*r,l=~~(.299*t[u]+.587*t[u+1]+.114*t[u+2]);this.computePixelValueRSAT_(e,r,s,g,k,l||0)}o&&this.computePixelValueSAT_(o,r,s,g,c[h])}},tracking.Image.computePixelValueRSAT_=function(t,r,n,a,i,e){var o=n*r+a;t[o]=(t[o-r-1]||0)+(t[o-r+1]||0)-(t[o-r-r]||0)+i+e},tracking.Image.computePixelValueSAT_=function(t,r,n,a,i){var e=n*r+a;t[e]=(t[e-r]||0)+(t[e-1]||0)+i-(t[e-r-1]||0)},tracking.Image.grayscale=function(t,r,n){for(var a=new Uint8ClampedArray(r*n*4),i=0,e=0,o=0;n>o;o++)for(var c=0;r>c;c++){var s=.299*t[e]+.587*t[e+1]+.114*t[e+2];a[i++]=s,a[i++]=s,a[i++]=s,a[i++]=t[e+3],e+=4}return a},tracking.Image.horizontalConvolve=function(t,r,n,a,i){for(var e=a.length,o=Math.floor(e/2),c=new Float32Array(r*n*4),s=i?1:0,g=0;n>g;g++)for(var h=0;r>h;h++){for(var k=g,u=h,l=4*(g*r+h),f=0,m=0,y=0,v=0,d=0;e>d;d++){var p=k,A=Math.min(r-1,Math.max(0,u+d-o)),T=4*(p*r+A),w=a[d];f+=t[T]*w,m+=t[T+1]*w,y+=t[T+2]*w,v+=t[T+3]*w}c[l]=f,c[l+1]=m,c[l+2]=y,c[l+3]=v+s*(255-v)}return c},tracking.Image.verticalConvolve=function(t,r,n,a,i){for(var e=a.length,o=Math.floor(e/2),c=new Float32Array(r*n*4),s=i?1:0,g=0;n>g;g++)for(var h=0;r>h;h++){for(var k=g,u=h,l=4*(g*r+h),f=0,m=0,y=0,v=0,d=0;e>d;d++){var p=Math.min(n-1,Math.max(0,k+d-o)),A=u,T=4*(p*r+A),w=a[d];f+=t[T]*w,m+=t[T+1]*w,y+=t[T+2]*w,v+=t[T+3]*w}c[l]=f,c[l+1]=m,c[l+2]=y,c[l+3]=v+s*(255-v)}return c},tracking.Image.separableConvolve=function(t,r,n,a,i,e){var o=this.verticalConvolve(t,r,n,i,e);return this.horizontalConvolve(o,r,n,a,e)},tracking.Image.sobel=function(t,r,n){t=this.grayscale(t,r,n);for(var a=new Float32Array(r*n*4),i=new Float32Array([-1,0,1]),e=new Float32Array([1,2,1]),o=this.separableConvolve(t,r,n,i,e),c=this.separableConvolve(t,r,n,e,i),s=0;s<a.length;s+=4){var g=o[s],h=c[s],k=Math.sqrt(h*h+g*g);a[s]=k,a[s+1]=k,a[s+2]=k,a[s+3]=255}return a}}(),function(){tracking.Math={},tracking.Math.distance=function(t,r,n,a){var i=n-t,e=a-r;return Math.sqrt(i*i+e*e)},tracking.Math.hammingWeight=function(t){return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24},tracking.Math.uniformRandom=function(t,r){return t+Math.random()*(r-t)},tracking.Math.intersectRect=function(t,r,n,a,i,e,o,c){return!(i>n||t>o||e>a||r>c)}}(),function(){tracking.Matrix={},tracking.Matrix.forEach=function(t,r,n,a,i){var e,o=i||1,c=0,s=0;for(c=0;n>c;c+=o)for(s=0;r>s;s+=o)e=c*r*4+4*s,a.call(this,t[e],t[e+1],t[e+2],t[e+3],e,c,s)}}(),function(){tracking.DisjointSet=function(t){if(void 0===t)throw new Error("DisjointSet length not specified.");this.length=t,this.parent=new Uint32Array(t);for(var r=0;t>r;r++)this.parent[r]=r},tracking.DisjointSet.prototype.length=null,tracking.DisjointSet.prototype.parent=null,tracking.DisjointSet.prototype.find=function(t){return this.parent[t]===t?t:this.parent[t]=this.find(this.parent[t])},tracking.DisjointSet.prototype.union=function(t,r){var n=this.find(t),a=this.find(r);this.parent[n]=a}}(),function(){tracking.Tracker=function(){},tracking.Tracker.prototype.onFound=function(){},tracking.Tracker.prototype.onNotFound=function(){},tracking.Tracker.prototype.track=function(){}}(),function(){tracking.HAARTracker=function(){tracking.HAARTracker.base(this,"constructor")},tracking.inherits(tracking.HAARTracker,tracking.Tracker),tracking.HAARTracker.data={},tracking.HAARTracker.prototype.data=null,tracking.HAARTracker.prototype.edgesDensity=.2,tracking.HAARTracker.prototype.initialScale=1,tracking.HAARTracker.prototype.scaleFactor=1.25,tracking.HAARTracker.prototype.stepSize=1.5,tracking.HAARTracker.prototype.getData=function(){return this.data},tracking.HAARTracker.prototype.getEdgesDensity=function(){return this.edgesDensity},tracking.HAARTracker.prototype.getInitialScale=function(){return this.initialScale},tracking.HAARTracker.prototype.getScaleFactor=function(){return this.scaleFactor},tracking.HAARTracker.prototype.getStepSize=function(){return this.stepSize},tracking.HAARTracker.prototype.track=function(t,r,n){var a=this.getData();if(!a)throw new Error("HAAR cascade data not set.");var i=tracking.ViolaJones.detect(t,r,n,this.getInitialScale(),this.getScaleFactor(),this.getStepSize(),this.getEdgesDensity(),a);i.length?this.onFound&&this.onFound.call(this,i):this.onNotFound&&this.onNotFound.call(this,i)},tracking.HAARTracker.prototype.setData=function(t){this.data=t},tracking.HAARTracker.prototype.setEdgesDensity=function(t){this.edgesDensity=t},tracking.HAARTracker.prototype.setInitialScale=function(t){this.initialScale=t},tracking.HAARTracker.prototype.setScaleFactor=function(t){this.scaleFactor=t},tracking.HAARTracker.prototype.setStepSize=function(t){this.stepSize=t}}(),function(){tracking.ColorTracker=function(){tracking.ColorTracker.base(this,"constructor"),this.setColors(["magenta"])},tracking.inherits(tracking.ColorTracker,tracking.Tracker),tracking.ColorTracker.MIN_PIXELS=30,tracking.ColorTracker.knownColors_={},tracking.ColorTracker.neighbours_={},tracking.ColorTracker.registerColor=function(t,r){tracking.ColorTracker.knownColors_[t]=r},tracking.ColorTracker.getColor=function(t){return tracking.ColorTracker.knownColors_[t]},tracking.ColorTracker.prototype.colors=null,tracking.ColorTracker.prototype.calculateDimensions_=function(t,r){for(var n=-1,a=-1,i=1/0,e=1/0,o=0;r>o;o+=2){var c=t[o],s=t[o+1];i>c&&(i=c),c>n&&(n=c),e>s&&(e=s),s>a&&(a=s)}return{maxx:n,maxy:a,minx:i,miny:e}},tracking.ColorTracker.prototype.getColors=function(){return this.colors},tracking.ColorTracker.prototype.getNeighboursForWidth_=function(t){if(tracking.ColorTracker.neighbours_[t])return tracking.ColorTracker.neighbours_[t];var r=new Int32Array(8);return r[0]=4*-t,r[1]=4*-t+4,r[2]=4,r[3]=4*t+4,r[4]=4*t,r[5]=4*t-4,r[6]=-4,r[7]=4*-t-4,tracking.ColorTracker.neighbours_=r,r},tracking.ColorTracker.prototype.regroupResults_=function(t){for(var r,n=[],a=0;a<t.length;a++){r=!0;for(var i=a+1;i<t.length;i++)if((t[a].minx>=t[i].minx&&t[a].minx<=t[i].maxx||t[a].maxx>=t[i].minx&&t[a].maxx<=t[i].maxx)&&(t[a].miny>=t[i].miny&&t[a].miny<=t[i].maxy||t[a].maxy>=t[i].miny&&t[a].maxy<=t[i].maxy)){r=!1,t[i].minx=Math.min(t[a].minx,t[i].minx),t[i].maxx=Math.max(t[a].maxx,t[i].maxx),t[i].miny=Math.min(t[a].miny,t[i].miny),t[i].maxy=Math.max(t[a].maxy,t[i].maxy),t[i].z=60-(t[i].maxx-t[i].minx+(t[i].maxy-t[i].miny))/2;break}r&&n.push({color:t[a].color,height:t[a].maxy-t[a].miny,width:t[a].maxx-t[a].minx,x:t[a].minx,y:t[a].miny})}return n},tracking.ColorTracker.prototype.setColors=function(t){this.colors=t},tracking.ColorTracker.prototype.track=function(t,r,n){for(var a=this.getColors(),i=[],e=0;e<a.length;e++)i.push(this.trackColor_(t,r,n,a[e]));i.length?this.onFound&&this.onFound.call(this,i):this.onNotFound&&this.onNotFound.call(this,i)},tracking.ColorTracker.prototype.trackColor_=function(n,a,i,e){var o,c,s,g,h,k=tracking.ColorTracker.knownColors_[e],u=new Int32Array(n.length>>2),l=new Int8Array(n.length),f=tracking.ColorTracker.MIN_PIXELS,m=this.getNeighboursForWidth_(a),y=new Int32Array(n.length),v=[],d=-4;if(!k)return v;for(var p=0;i>p;p++)for(var A=0;a>A;A++)if(d+=4,!l[d]){for(o=0,h=-1,y[++h]=d,y[++h]=p,y[++h]=A,l[d]=1;h>=0;)if(s=y[h--],c=y[h--],g=y[h--],k.call(this,n[g],n[g+1],n[g+2],n[g+3],g,c,s)){u[o++]=s,u[o++]=c;for(var T=0;T<m.length;T++){var w=g+m[T],x=c+t[T],C=s+r[T];!l[w]&&x>=0&&i>x&&C>=0&&a>C&&(y[++h]=w,y[++h]=x,y[++h]=C,l[w]=1)}}if(o>=f){var _=this.calculateDimensions_(u,o);_&&(_.color=e,v.push(_))}}return this.regroupResults_(v)},tracking.ColorTracker.registerColor("cyan",function(t,r,n){var a=50,i=70,e=t-0,o=r-255,c=n-255;return r-t>=a&&n-t>=i?!0:6400>e*e+o*o+c*c}),tracking.ColorTracker.registerColor("magenta",function(t,r,n){var a=50,i=t-255,e=r-0,o=n-255;return t-r>=a&&n-r>=a?!0:19600>i*i+e*e+o*o}),tracking.ColorTracker.registerColor("yellow",function(t,r,n){var a=50,i=t-255,e=r-255,o=n-0;return t-n>=a&&r-n>=a?!0:1e4>i*i+e*e+o*o});var t=new Int32Array(8),r=new Int32Array(8);t[0]=-1,t[1]=-1,t[2]=0,t[3]=1,t[4]=1,t[5]=1,t[6]=0,t[7]=-1,r[0]=0,r[1]=1,r[2]=1,r[3]=1,r[4]=0,r[5]=-1,r[6]=-1,r[7]=-1}(),function(){tracking.EyeTracker=function(){tracking.EyeTracker.base(this,"constructor");var t=tracking.HAARTracker.data.eye;t&&this.setData(new Float64Array(t))},tracking.inherits(tracking.EyeTracker,tracking.HAARTracker)}(),function(){tracking.FaceTracker=function(){tracking.FaceTracker.base(this,"constructor");var t=tracking.HAARTracker.data.face;t&&this.setData(new Float64Array(t))},tracking.inherits(tracking.FaceTracker,tracking.HAARTracker)}(),function(){tracking.MouthTracker=function(){tracking.MouthTracker.base(this,"constructor");var t=tracking.HAARTracker.data.mouth;t&&this.setData(new Float64Array(t))},tracking.inherits(tracking.MouthTracker,tracking.HAARTracker)}();